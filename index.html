<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta
      name="viewport"
      content="initial-scale=1,maximum-scale=1,user-scalable=no"
    />
    <title>map</title>
    <link
      rel="icon"
      type="image/x-icon"
      href="data:image/x-icon;base64,AAABAAEAEBAQAAAAAAAoAQAAFgAAACgAAAAQAAAAIAAAAAEABAAAAAAAgAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAEhEQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA//8AAP7/AAD//wAA//8AAP//AAD//wAA//8AAP//AAD//wAA"
    />
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <link
      rel="stylesheet"
      type="text/css"
      href="https://unpkg.com/leaflet.markercluster@1.0.4/dist/MarkerCluster.Default.css"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="https://unpkg.com/leaflet.markercluster@1.0.4/dist/MarkerCluster.css"
    />

    <style>
      body {
        margin: 0;
        padding: 0;
      }
      #map {
        position: absolute;
        top: 0;
        bottom: 0;
        right: 0;
        left: 0;
      }
    </style>
  </head>
  <body>
    <div id="map"></div>
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="https://unpkg.com/esri-leaflet/dist/esri-leaflet.js"></script>
    <script src="https://unpkg.com/leaflet.markercluster@1.0.4/dist/leaflet.markercluster.js"></script>
    <script src="https://unpkg.com/esri-leaflet-cluster@2.0.0/dist/esri-leaflet-cluster.js"></script>

    <script>
      "use strict";
      let uri =
        "https://services.arcgis.com/rOo16HdIMeOBI4Mb/ArcGIS/rest/services/USA_Rail_Network/FeatureServer/0";

      function runr(lat, lon) {
        // var map = L.map("map").setView([lat, lon], 5);
        var map = L.map("map").setView([45.526, -122.667], 9);

        L.esri.basemapLayer("Gray").addTo(map);
        // var items = L.esri.featureLayer({ url: uri }).addTo(map);
        // const worldCities = L.esri
        //   .featureLayer({
        //     url:
        //       "https://sampleserver6.arcgisonline.com/arcgis/rest/services/SampleWorldCities/MapServer/0"
        //   })
        //   .addTo(map);

        // worldCities.bindPopup(function(e) {
        //   return L.Util.template(
        //     "<div>{CITY_NAME}</div><div>" +
        //       e.feature.properties.POP.toLocaleString() +
        //       "</div>",
        //     e.feature.properties
        //   );
        // });
        let qwer = L.esri.Cluster.featureLayer({
          url:
            "https://services.arcgis.com/rOo16HdIMeOBI4Mb/arcgis/rest/services/Trimet_Transit_Stops/FeatureServer/0"
        }).addTo(map);

        qwer.bindPopup(function(e) {
          let zxcv = JSON.stringify(e.feature.properties)
            .split(",")
            .join("</div><div>");
          return L.Util.template(
            "<div>" + zxcv + "</div>",
            e.feature.properties
          );
        });
      }

      if ("geolocation" in navigator) {
        navigator.geolocation.getCurrentPosition(function(position) {
          runr(position.coords.latitude, position.coords.longitude);
        });
      }
    </script>
  </body>
</html>
